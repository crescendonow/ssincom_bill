<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <title>Tax Invoice</title>
  <style>
    @page {
      size: A4;
      margin: 8mm;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: "TH Sarabun New", "Tahoma", sans-serif;
      font-size: 12pt;
      /* เดิม 15pt */
      color: #0F3F7F;
      line-height: 1.2;
      /* เพิ่ม ลดช่องไฟแนวตั้ง */
    }

    .doc {
      border: 2px solid #0F3F7F;
      border-radius: 10px;
      padding: 12px;
    }

    .row {
      display: flex;
      gap: 12px;
    }

    .col {
      flex: 1;
    }

    .box {
      border: 2px solid #0F3F7F;
      border-radius: 10px;
      padding: 10px;
    }

    .box-light {
      border: 1.5px solid #0F3F7F;
      border-radius: 10px;
      padding: 8px;
    }

    .title {
      font-weight: 700;
      font-size: 16pt;
    }

    .sub {
      font-size: 11pt;
      color: #1c5ca5;
    }

    .right {
      text-align: right;
    }

    .center {
      text-align: center;
    }

    .muted {
      color: #1c5ca5;
      font-size: 10pt;
    }

    .mt6 {
      margin-top: 3px;
    }

    .mt10 {
      margin-top: 6px;
    }

    .mt14 {
      margin-top: 8px;
    }

    .logo {
      height: 70px;
    }

    /* กรอบนอกตารางสินค้า: ไม่มีเส้นบน */
    .table-frame {
      border: 1.5px solid #0F3F7F;
      border-top: none;
      /* ตัดเส้นบนออก */
      border-radius: 0 0 10px 10px;
      /* มุมมนเฉพาะด้านล่าง */
      overflow: hidden;
      /* ให้มุมมนล่างทำงาน */
    }

    /* ตารางภายใน */
    table.items {
      width: 100%;
      border-collapse: collapse;
    }

    /* หัวตาราง: สร้างเส้นบน + มุมโค้ง */
    table.items th {
      background: #eef5ff;
      font-weight: 700;
      padding: 6px 8px;
      text-align: center;

      /* เส้นบนหัวตาราง = เส้นบนของกรอบ */
      border-top: 1.5px solid #0F3F7F;
      border-bottom: 1.5px solid #0F3F7F;
      /* เส้นใต้หัวตาราง */
    }

    /* เส้นแนวตั้งแบ่งคอลัมน์ในหัวตาราง */
    table.items th+th {
      border-left: 1.5px solid #0F3F7F;
    }

    /* มุมโค้งบน */
    table.items th:first-child {
      border-top-left-radius: 10px;
    }

    table.items th:last-child {
      border-top-right-radius: 10px;
    }

    /* ข้อมูล: ไม่มีเส้นบน/ล่าง แต่มีเส้นแนวตั้ง */
    table.items td {
      padding: 6px 8px;
      vertical-align: top;
      border: none;
    }

    table.items td+td {
      border-left: 1.5px solid #0F3F7F;
    }

    th {
      background: #eef5ff;
      font-weight: 700;
    }

    .no-border {
      border: none !important;
    }

    .sumtable td {
      padding: 2px 6px;
      /* ปรับ padding แนวตั้ง/แนวนอน */
      line-height: 1.2;
      /* ลดความสูงบรรทัด */
    }

    .sumtable {
      border-collapse: collapse;
    }

    /* แยก selector ปกติ (ห้ามซ้อนใน CSS ปกติ) */
    .sumtable td {
      border: none;
      padding: 1px 4px;
      /* เดิม 2px 6px */
      line-height: 1.1;
      /* เดิม 1.2 */
    }

    .sumtable tr td:first-child {
      padding-right: 14px;
    }

    .big-amount {
      font-size: 14pt;
      font-weight: 700;
    }

    /* ไม่พิมพ์ปุ่มและทุกอย่างภายใน .noprint */
    @media print {

      .noprint,
      .noprint * {
        display: none !important;
      }

      body {
        font-size: 13pt;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .doc {
        padding: 6mm;
        box-shadow: none;
      }

      th,
      td {
        padding: 4px 6px;
      }

      .box,
      .box-light {
        padding: 6px;
      }
    }
  </style>
</head>

<body>

  <div class="doc">
    <!-- head block -->
    <div class="row" style="align-items: flex-start; justify-content: space-between;">
      <!-- ฝั่งซ้าย -->
      <div style="display: flex; flex: 1;">
        <div style="flex:0 0 120px; text-align:center;">
          <img src="/static/ss_logo.png" class="logo" alt="logo" />
          <div class="muted" style="margin-top:4px;">สำนักงานใหญ่:</div>
        </div>
        <div
          style="text-align:left; padding-left:10px; display:flex; flex-direction:column; justify-content:flex-start;">
          <div class="title" style="align-self:flex-start;">
            บริษัท เอส แอนด์ เอส อินคอม จำกัด
          </div>
          <div class="title">S &amp; S INCOM CO., LTD.</div>
          <div class="muted">69 หมู่ 10 ตำบลพังตรุ อำเภอพนมทวน จังหวัดกาญจนบุรี 71140</div>
          <div class="muted">โทร. (035) 589 274, (081) 880 8840, (092) 265 9156</div>
          <!-- ✅ ใส่ id ที่บรรทัดอีเมล -->
          <div class="muted" id="company-email" style="font-size:12pt;">
            website: www.ssincom.com Email: mailtossincom@gmail.com
          </div>
        </div>
      </div>

      <!-- ฝั่งขวา -->
      <div id="header-right" style="flex:0 0 auto; text-align:right; align-self:flex-start;">
        <div class="title" style="font-size:18pt; white-space:nowrap;">
          ต้นฉบับใบกำกับภาษี/ใบส่งของ/ใบแจ้งหนี้
        </div>
        <div class="title" style="font-size:14pt; white-space:nowrap;">
          TAX INVOICE/DELIVERY ORDER /INVOICE ORIGINAL
        </div>

        <!-- ✅ เว้นจากบรรทัด TAX... -->
        <div id="tax-label" class="muted" style="margin-top:12px;">เลขประจำตัวผู้เสียภาษีอากร</div>

        <!-- ✅ เลขภาษี: จะจัดแนวให้ตรงกับบรรทัดอีเมลด้วย JS -->
        <div class="title" id="tax-id" style="font-size:18pt; white-space:nowrap;">
          0715544000020
        </div>
      </div>
    </div>

    <!-- เส้นคั่น -->
    <hr style="border: 1px solid #0F3F7F; margin: 8px 0;">

    <!-- แถวข้อมูลลูกค้า + เลขที่เอกสาร -->
    <div class="row mt10">
      <div class="col box-light" style="font-size:14pt;">
        <div class="mt6">รหัสลูกค้า: <b>{{ invoice.customer_code or invoice.personid }}</b></div>
        <div class="mt6">ชื่อลูกค้า: <b>{{ invoice.customer_name }}</b></div>
        <div class="mt6">เลขประจำตัวผู้เสียภาษี: <b>{{ invoice.customer_taxid }}</b> / {{ invoice.customer_branch or
          'สำนักงานใหญ่' }}</div>
        <div class="mt6">ที่อยู่: <b>{{ invoice.customer_address }}</b></div>
        <div class="mt6">โทรศัพท์: <b>{{ invoice.tel or invoice.mobile or '' }}</b></div>
      </div>
      <div class="col box-light" style="flex:0 0 320px; font-size:14pt;">
        <div>เลขที่: <b>{{ invoice.invoice_number }}</b></div>
        <div class="mt6">วันที่: <b>{{ invoice.invoice_date | thaidate }}</b></div>
        <div class="mt6">เลขที่ใบสั่งซื้อ: <b>{{ invoice.po_number }}</b></div>
        <div class="mt6">เงื่อนไขการชำระเงิน: <b>{{ invoice.fmlpaymentcreditday }}</b></div>
        <div class="mt6">วันครบกำหนดชำระเงิน: <b>{{ invoice.due_date | default(invoice.invoice_date, true) | thaidate
            }}</b></div>
        <div class="mt6">เลขที่ใบรับสินค้า: <b>{{ invoice.grn_number }}</b></div>
        <div class="mt6">เลขที่ใบส่งสินค้า: <b>{{ invoice.dn_number }}</b></div>
      </div>
    </div>

    <!-- ตารางสินค้า -->
    <div class="table-frame">
      <table class="items mt6">
        <thead>
          <tr>
            <th class="center" style="width:6%;">ลำดับ</th>
            <th class="center" style="width:16%;">รหัสสินค้า</th>
            <th class="center">ชื่อสินค้า / รายละเอียด</th>
            <th class="center" style="width:12%;">จำนวน</th>
            <th class="center" style="width:14%;">ราคาต่อหน่วย</th>
            <th class="center" style="width:16%;">จำนวนเงิน</th>
          </tr>
        </thead>
        <tbody>
          {% set ns = namespace(total=0) %}
        <tbody>
          {% for item in invoice["items"] %}
          {% set qty = item["quantity"]|float %}
          {% set price = item["unit_price"]|float %}
          {% set amount = qty * price %}
          {% set ns.total = ns.total + amount %}
          <tr>
            <td class="center">{{ loop.index }}</td>
            <td class="center">{{ item["product_code"] }}</td>
            <td>{{ item["description"] }}</td>
            <td class="right">{{ '{:,.2f}'.format(qty) }}</td>
            <td class="right">{{ '{:,.2f}'.format(price) }}</td>
            <td class="right">{{ '{:,.2f}'.format(amount) }}</td>
          </tr>
          {% endfor %}

          {% set filler = 8 - (invoice["items"]|length) %}
          {% for i in range(filler if filler > 0 else 0) %}
          <tr>
            <td>&nbsp;</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- หมายเหตุ + สรุปยอด -->
    <div class="row mt10">
      <div class="col box-light">
        <div class="muted"><b>หมายเหตุ</b></div>
        <div class="muted" style="line-height:1.25;">
          โปรดโอเนเงินในนาม <b>“บริษัท เอส แอนด์ เอส อินคอม จำกัด”</b> เท่านั้น
          เมื่อพ้นกำหนดการชำระเงิน บริษัทฯ ขอสงวนสิทธิ์คิดดอกเบี้ยอัตราร้อยละ 1.5 ต่อเดือน
          สินค้าที่ยังมิได้ชำระเงินยังเป็นกรรมสิทธิ์ของบริษัท เอส แอนด์ เอส อินคอม จำกัด
          จนกว่าผู้ซื้อจะชำระค่าสินค้าเรียบร้อยแล้ว
          ได้รับสินค้าตามรายการข้างต้นไว้ในสภาพเรียบร้อยเป็นการถูกต้องแล้ว
        </div>
      </div>

      <div class="col" style="flex:0 0 380px;">
        {% set discount = (discount|float) if discount is defined else 0.0 %}
        {% set before_vat = ns.total - discount %}
        {% set vat = (vat_rate|float if vat_rate is defined else 7.0) %}
        {% set vat_amt = before_vat * (vat/100.0) %}
        {% set grand = before_vat + vat_amt %}
        <div class="box">
          <table class="sumtable" style="width:100%;">
            <tr>
              <td>รวมราคา / Amount</td>
              <td class="right">{{ '{:,.2f}'.format(ns.total) }}</td>
            </tr>
            <tr>
              <td>ส่วนลด / Discount</td>
              <td class="right">{{ '{:,.2f}'.format(discount) }}</td>
            </tr>
            <tr>
              <td>รวมเป็นเงิน / Sub Total</td>
              <td class="right">{{ '{:,.2f}'.format(before_vat) }}</td>
            </tr>
            <tr>
              <td>ภาษีมูลค่าเพิ่ม / Vat {{ '{:.0f}%'.format(vat) }}</td>
              <td class="right">{{ '{:,.2f}'.format(vat_amt) }}</td>
            </tr>
            <tr>
              <td><b>จำนวนเงินรวมทั้งสิ้น / Net Total</b></td>
              <td class="right big-amount"><b>{{ '{:,.2f}'.format(grand) }}</b></td>
            </tr>
          </table>
          <div style="text-align:right; margin-top:6px; font-style:italic;">
            ( {{ grand | thbaht }} )
          </div>
        </div>
      </div>
    </div>

    <!-- ลายเซ็น -->
    <div class="row mt14">
      <div class="col center box-light">
        ผู้รับสินค้า / วันที่<br /><br /><br />..................................
      </div>
      <div class="col center box-light">
        ผู้ตรวจสินค้า<br /><br /><br />..................................
      </div>
      <div class="col center box-light">
        ผู้มีอำนาจลงนาม<br /><br /><br />..................................
      </div>
      <div class="col center box-light" style="flex:0 0 220px;">
        ทะเบียนรถจัดส่ง:<br /><br /><b>{{ invoice.car_numberplate}}</b>
      </div>
    </div>
  </div>

  <div class="noprint" style="margin-top:14px; text-align:right;">
    <button onclick="window.print()"
      style="padding:8px 14px; background:#0F3F7F; color:#fff; border:none; border-radius:8px; cursor:pointer;">
      🖨️ พิมพ์ / บันทึก PDF
    </button>
  </div>

  <script src="/static/js/form.js"></script>
</body>

</html>
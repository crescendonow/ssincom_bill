<!DOCTYPE html>
<html>

<body>
  <form action="/submit" method="post">
    <input name="invoice_number" placeholder="Invoice No"><br>
    <input name="invoice_date" type="date"><br>
    <input name="customer_name" id="customer_name" list="customerList" oninput="selectCustomer()" autocomplete="off"
      placeholder="Customer_name"><br>
    <datalist id="customerList"></datalist>
    <input name="customer_taxid" placeholder="Tax ID"><br>
    <input name="customer_address" placeholder="Address"><br>
    <hr>
    <div id="items">
      <div>
        <input name="product_code" placeholder="Product Code">
        <input name="description" placeholder="Description">
        <input name="quantity" type="number" step="0.01" placeholder="Qty">
        <input name="unit_price" type="number" step="0.01" placeholder="Unit Price">
      </div>
    </div>
    <button type="button" onclick="addItem()">Add Item</button><br><br>
    <input type="submit" value="Submit">
  </form>
  <script>
    let customers = [];
    fetch('/api/customers')
      .then(res => res.json())
      .then(data => {
        customers = data;
        let html = "";
        data.forEach(c => {
          html += `<option value="${c.fname}">`;
        });
        document.getElementById("customerList").innerHTML = html;
      });

    function normalize(str) {
      return str.normalize("NFC").trim();
    }

    function selectCustomer() {
      const name = normalize(document.getElementById("customer_name").value);
      const match = customers.find(c => normalize(c.fname) === name);
    }

    function addItem() {
      const div = document.createElement('div');
      div.innerHTML = `<input name="product_code" placeholder="Product Code">
                       <input name="description" placeholder="Description">
                       <input name="quantity" type="number" step="0.01" placeholder="Qty">
                       <input name="unit_price" type="number" step="0.01" placeholder="Unit Price">`;
      document.getElementById('items').appendChild(div);
    }
  </script>
</body>

</html>